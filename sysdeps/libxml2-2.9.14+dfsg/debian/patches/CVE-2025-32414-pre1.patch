From 40abebbc739fb4cddfc205eeb129cefe9b9f6e5b Mon Sep 17 00:00:00 2001
From: Nick Wellnhofer <wellnhofer@aevum.de>
Date: Thu, 29 Aug 2024 01:02:33 +0200
Subject: [PATCH] python: Fix SAX driver with character streams

This apparently broke with Python 3.5 which introduced character
streams.

Fixes #790.
---
 python/drv_libxml2.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/python/drv_libxml2.py b/python/drv_libxml2.py
index 71b1c67db..363c6f81d 100644
--- a/python/drv_libxml2.py
+++ b/python/drv_libxml2.py
@@ -146,7 +146,10 @@ class LibXml2Reader(xmlreader.XMLReader):
                 reader = libxml2.newTextReaderFilename(source)
             else:
                 source = saxutils.prepare_input_source(source)
-                input = libxml2.inputBuffer(source.getByteStream())
+                stream = source.getCharacterStream()
+                if stream is None:
+                    stream = source.getByteStream()
+                input = libxml2.inputBuffer(stream)
                 reader = input.newTextReader(source.getSystemId())
             reader.SetErrorHandler(self._errorHandler,None)
             # configure reader
-- 
GitLab

